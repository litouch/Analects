<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>我的收藏 - 论语SDK</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/v2/analects.css">
  <link rel="preconnect" href="https://fonts.loli.net">
  <link href="https://fonts.loli.net/css2?family=Inter:wght@400;500;600&family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
    h1, h2, h3 { font-family: 'Noto Serif SC', serif; }
  </style>
  <!-- [问题2修复] 添加此样式块以防止FOUC并实现平滑淡入 -->
  <style>
    #main-container {
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }
  </style>
</head>
<body class="text-gray-800 antialiased">

  <!-- [问题2修复] 为主容器添加ID -->
  <div id="main-container" class="container mx-auto max-w-4xl px-4 py-8">
    
	<header class="text-center mb-8 border-b pb-4">
	      <h1 class="text-3xl md:text-4xl font-bold text-gray-900">我的收藏</h1>
	      <p class="text-lg text-gray-500 mt-2">论语收藏，论语笔记</p>
	      <a href="/" class="text-blue-600 hover:underline mt-4 inline-block">&larr; 返回首页</a>

	      <div class="mt-6 max-w-lg mx-auto">
	        <div class="relative">
	          <span class="absolute inset-y-0 left-0 flex items-center pl-3">
	            <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
	              <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
	            </svg>
	          </span>
	          <input id="favorites-search-input" type="search" 
	                 class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500" 
	                 placeholder="在您的收藏和笔记中搜索...">
	        </div>
	      </div>
	      </header>

	<main id="favorites-list-container" class="space-y-4">
	      <div class="analects-loading text-center text-gray-500 py-8">正在加载您的收藏...</div>
	    </main>

  </div>

  <div id="analects-global-widget-container"></div>

  <script src="/v2/analects.js"></script>
  <script>
   (async () => {
    // 1. 立即初始化SDK实例
    const sdk = new AnalectsSDK({
      supabaseUrl: 'https://btqbtibvevglwcpiewyu.supabase.co',
      supabaseKey: 'sb_publishable_Kl_dygwfqk0Uey1G-0rj3A_4sbCgnet'
    });
    
    // 2. [核心修改] 首先，并且只等待 sdk.init() 完成。
    //    这一步将确保 SDK 内部的 currentUser 状态是正确的。
    await sdk.init();

    // 3. 在登录状态完全确认后，再并行渲染所有需要登录状态的UI组件
    const favoritesContainer = document.getElementById('favorites-list-container');
  
    // 此时，favoritesContainer 内部还是HTML预置的骨架屏
    favoritesContainer.style.opacity = 0; // 准备用真实数据替换骨架屏

    await Promise.all([
        sdk.renderGlobalWidget(document.getElementById('analects-global-widget-container')),
        sdk.renderMyFavoritesPage(favoritesContainer)
    ]);
  
    // 4. 真实数据渲染完成后，再让列表容器淡入显示
    favoritesContainer.style.opacity = 1;
  
    // 5. 初始化搜索功能
    sdk.initializeFavoritesSearch(
        document.getElementById('favorites-search-input'),
        favoritesContainer
    );
    
    })();
  </script>

</body>
</html>
